<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js + Onirix AR with Pinch Zoom and Rotate</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
    <script src="https://sdk.onirix.com/latest/onirix-sdk.js"></script>
    
    <script>
        let scene, camera, renderer, object3D;
        let isPinching = false, initialDistance = 0, currentDistance = 0;
        let isRotating = false;
        let touchStartX = 0, touchStartY = 0;
        let objectRotationX = 0, objectRotationY = 0;

        // Initialize Onirix experience
        const experience = new OX.Experience({
            apiKey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjUyMDIsInByb2plY3RJZCI6MTQ0MjgsInJvbGUiOjMsImlhdCI6MTYxNjc1ODY5NX0.8F5eAPcBGaHzSSLuQAEgpdja9aEZ6Ca_Ll9wg84Rp5k",  // Replace this with your actual Onirix API key
            onReady: startScene
        });

        // Function to start and setup the scene
        function startScene() {
            // Initialize Three.js Scene
            scene = new THREE.Scene();

            // Setup Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 5);

            // Setup Renderer
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Create a simple object (Box) and add to the scene
            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            object3D = new THREE.Mesh(geometry, material);
            scene.add(object3D);

            // Start animation loop
            animate();

            // Add touch event listeners
            renderer.domElement.addEventListener('touchstart', handleTouchStart, false);
            renderer.domElement.addEventListener('touchmove', handleTouchMove, false);
            renderer.domElement.addEventListener('touchend', handleTouchEnd, false);
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Handle touch start for rotation and pinch zoom
        function handleTouchStart(event) {
            if (event.touches.length === 1) {
                // Single touch: start rotation
                isRotating = true;
                touchStartX = event.touches[0].pageX;
                touchStartY = event.touches[0].pageY;
                objectRotationX = object3D.rotation.x;
                objectRotationY = object3D.rotation.y;
            } else if (event.touches.length === 2) {
                // Two fingers: start pinch zoom
                isPinching = true;
                initialDistance = Math.hypot(
                    event.touches[0].pageX - event.touches[1].pageX,
                    event.touches[0].pageY - event.touches[1].pageY
                );
            }
        }

        // Handle touch move to update rotation or pinch zoom
        function handleTouchMove(event) {
            if (isRotating && event.touches.length === 1) {
                // Update object rotation
                const deltaX = event.touches[0].pageX - touchStartX;
                const deltaY = event.touches[0].pageY - touchStartY;
                object3D.rotation.x = objectRotationX + deltaY * 0.01;
                object3D.rotation.y = objectRotationY + deltaX * 0.01;
            } else if (isPinching && event.touches.length === 2) {
                // Update pinch zoom scaling
                currentDistance = Math.hypot(
                    event.touches[0].pageX - event.touches[1].pageX,
                    event.touches[0].pageY - event.touches[1].pageY
                );
                const scaleFactor = currentDistance / initialDistance;
                object3D.scale.set(scaleFactor, scaleFactor, scaleFactor);
            }
        }

        // Handle touch end to stop rotation or pinch zoom
        function handleTouchEnd(event) {
            if (isRotating) {
                isRotating = false;
            }
            if (isPinching) {
                isPinching = false;
            }
        }
    </script>
</body>
</html>
